{% extends 'base.html' %}
{% block title %}–ì–æ—Å—Ç–∏ ‚Äî {{ wedding.name }}{% endblock %}

{% block content %}
<a href="{{ url_for('wedding_pages.view_wedding', wedding_id=wedding.id) }}"
   class="text-pink-600 hover:text-pink-800 font-semibold mb-6 inline-flex items-center gap-1">
  <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
  –ö –æ–±–∑–æ—Ä—É —Å–≤–∞–¥—å–±—ã
</a>

{# –∞–≥—Ä–µ–≥–∞—Ç—ã: –ø–µ—Ä—Å–æ–Ω/—Å–µ–º–µ–π/—Å—Ç–æ–ª–æ–≤ #}
{% set ns = namespace(persons=0, families=0) %}
{% for g in wedding.guests %}
  {% if g.family_count %}
    {% set ns.persons = ns.persons + g.family_count %}
  {% else %}
    {% set ns.persons = ns.persons + 1 %}
  {% endif %}
  {% if g.family_name %}{% set ns.families = ns.families + 1 %}{% endif %}
{% endfor %}
{% set total_persons = ns.persons %}
{% set families_count = ns.families %}
{% set table_size = 12 %}
{% set tables_needed = (total_persons + table_size - 1) // table_size %}

<div class="flex items-center justify-between gap-4 flex-wrap">
  <h2 class="text-2xl font-extrabold mb-2 flex items-center gap-2">
    <span>üßë‚Äçü§ù‚Äçüßë</span> –ì–æ—Å—Ç–∏ ‚Äî <span class="text-pink-700">{{ wedding.name }}</span>
  </h2>

  <div class="flex items-center gap-3">
    <form method="POST" action="{{ url_for('wedding_pages.auto_seat', wedding_id=wedding.id) }}"
          onsubmit="return confirm('–†–∞—Å—Å–∞–¥–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ 12 –º–µ—Å—Ç –Ω–∞ —Å—Ç–æ–ª?');">
      <button type="submit"
              class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white shadow">
        ü™ë –ê–≤—Ç–æ-—Ä–∞—Å—Å–∞–¥–∫–∞
      </button>
    </form>
    
<a href="{{ url_for('wedding_pages.seating_page', wedding_id=wedding.id) }}"
   class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-amber-500 hover:bg-amber-600 text-white shadow">
  ü™ë –†–∞—Å—Å–∞–¥–∫–∞
</a>

    <a href="{{ url_for('invitations_bp.invitations_zip', wedding_id=wedding.id) }}"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-pink-600 hover:bg-pink-700 text-white shadow">
      üì• –í—Å–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (ZIP)
    </a>
  </div>
</div>

<div x-data="guestPage('{{ url_for('wedding_pages.edit_guest', guest_id=0) }}')" class="mt-4">
  <!-- –∫–∞—Ä—Ç–æ—á–∫–∏-–∏—Ç–æ–≥–∏ -->
  <div class="grid md:grid-cols-4 gap-4 mb-6">
    <div class="glass p-4 rounded-2xl border">
      <div class="text-gray-500 text-sm">–ó–∞–ø–∏—Å–µ–π</div>
      <div class="text-2xl font-black">{{ wedding.guests|length }}</div>
    </div>
    <div class="glass p-4 rounded-2xl border">
      <div class="text-gray-500 text-sm">–ü–µ—Ä—Å–æ–Ω</div>
      <div class="text-2xl font-black">{{ total_persons }}</div>
    </div>
    <div class="glass p-4 rounded-2xl border">
      <div class="text-gray-500 text-sm">–°—Ç–æ–ª–æ–≤ (–ø–æ {{ table_size }})</div>
      <div class="text-2xl font-black">{{ tables_needed }}</div>
    </div>
    <div class="glass p-4 rounded-2xl border">
      <div class="text-gray-500 text-sm">–°–µ–º–µ–π</div>
      <div class="text-2xl font-black">{{ families_count }}</div>
    </div>
  </div>

  <!-- –ø–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
  <div class="bg-white/90 backdrop-blur rounded-2xl border p-4 shadow mb-4">
    <div class="grid sm:grid-cols-5 gap-3 items-end">
      <div>
        <label class="text-xs text-gray-500 block mb-1">–ü–æ–∏—Å–∫</label>
        <input x-model="q" class="border px-3 py-2 rounded-xl w-full" placeholder="–ò–º—è/—Å–µ–º—å—è/—Ç–µ–ª–µ—Ñ–æ–Ω">
      </div>
      <div>
        <label class="text-xs text-gray-500 block mb-1">–°—Ç–æ—Ä–æ–Ω–∞</label>
        <select x-model="filterSide" class="border px-3 py-2 rounded-xl w-full">
          <option value="">–í—Å–µ</option>
          <option value="groom">–°–æ —Å—Ç–æ—Ä–æ–Ω—ã –∂–µ–Ω–∏—Ö–∞</option>
          <option value="bride">–°–æ —Å—Ç–æ—Ä–æ–Ω—ã –Ω–µ–≤–µ—Å—Ç—ã</option>
          <option value="other">–î—Ä—É–≥–∞—è</option>
        </select>
      </div>
      <div>
        <label class="text-xs text-gray-500 block mb-1">VIP</label>
        <select x-model="filterVIP" class="border px-3 py-2 rounded-xl w-full">
          <option value="">–í—Å–µ</option>
          <option value="1">–¢–æ–ª—å–∫–æ VIP</option>
          <option value="0">–ù–µ VIP</option>
        </select>
      </div>
      <div>
        <label class="text-xs text-gray-500 block mb-1">–î–µ—Ç–∏</label>
        <select x-model="filterKids" class="border px-3 py-2 rounded-xl w-full">
          <option value="">–í—Å–µ</option>
          <option value="1">–¢–æ–ª—å–∫–æ –¥–µ—Ç–∏</option>
          <option value="0">–ë–µ–∑ –¥–µ—Ç–µ–π</option>
        </select>
      </div>
      <div>
        <label class="text-xs text-gray-500 block mb-1">–°—Ç–æ–ª ‚Ññ</label>
        <input x-model.number="filterTable" type="number" min="1" class="border px-3 py-2 rounded-xl w-full" placeholder="–ª—é–±–æ–µ">
      </div>
    </div>
  </div>

  <!-- —Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
  <div class="bg-white/90 backdrop-blur rounded-2xl border p-6 shadow mb-6">
    <div class="mb-3 font-bold text-gray-700 flex items-center gap-2">
      <span class="text-indigo-500">‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Å—Ç—è / —Å–µ–º—å—é
    </div>
    <p class="text-xs text-gray-500 mb-4">
      –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å <b>—Ç–æ–ª—å–∫–æ ¬´–°–µ–º—å—é¬ª –∏ ¬´–ü–µ—Ä—Å–æ–Ω¬ª</b> ‚Äî –ø–æ–ª–µ ¬´–ò–º—è –≥–æ—Å—Ç—è¬ª –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
    </p>

    <form method="POST" action="{{ url_for('wedding_pages.add_guest', wedding_id=wedding.id) }}"
          class="grid md:grid-cols-12 gap-4">
      <label class="md:col-span-3">
        <span class="text-xs text-gray-500 block mb-1">–ò–º—è –≥–æ—Å—Ç—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span>
        <input name="name" class="border p-2 rounded-xl w-full" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
      </label>

      <label class="md:col-span-3">
        <span class="text-xs text-gray-500 block mb-1">–°–µ–º—å—è (–æ–ø—Ü.)</span>
        <input name="family_name" class="border p-2 rounded-xl w-full" placeholder="–®–∏—Ä–∏–Ω–æ–≤—ã">
      </label>

      <label class="md:col-span-2">
        <span class="text-xs text-gray-500 block mb-1">–ü–µ—Ä—Å–æ–Ω</span>
        <input name="family_count" type="number" min="1" class="border p-2 rounded-xl w-full" placeholder="1">
      </label>

      <label class="md:col-span-2">
        <span class="text-xs text-gray-500 block mb-1">–¢–µ–ª–µ—Ñ–æ–Ω</span>
        <input name="phone" class="border p-2 rounded-xl w-full" placeholder="+998...">
      </label>

      <label class="md:col-span-2">
        <span class="text-xs text-gray-500 block mb-1">–°—Ç–æ–ª ‚Ññ (–æ–ø—Ü.)</span>
        <input name="table_no" type="number" min="1" class="border p-2 rounded-xl w-full" placeholder="‚Äî">
      </label>

      <label class="md:col-span-3">
        <span class="text-xs text-gray-500 block mb-1">–°—Ç–æ—Ä–æ–Ω–∞</span>
        <select name="side" class="border p-2 rounded-xl w-full">
          <option value="">‚Äî</option>
          <option value="groom">–°–æ —Å—Ç–æ—Ä–æ–Ω—ã –∂–µ–Ω–∏—Ö–∞</option>
          <option value="bride">–°–æ —Å—Ç–æ—Ä–æ–Ω—ã –Ω–µ–≤–µ—Å—Ç—ã</option>
          <option value="other">–î—Ä—É–≥–∞—è</option>
        </select>
      </label>

      <label class="md:col-span-2 flex items-center gap-2">
        <input type="checkbox" name="is_vip" value="1" class="rounded">
        <span class="text-sm">VIP</span>
      </label>

      <label class="md:col-span-2 flex items-center gap-2">
        <input type="checkbox" name="is_child" value="1" class="rounded">
        <span class="text-sm">–†–µ–±—ë–Ω–æ–∫</span>
      </label>

      <label class="md:col-span-3">
        <span class="text-xs text-gray-500 block mb-1">–°—Ç–∞—Ç—É—Å</span>
        <select name="status" class="border p-2 rounded-xl w-full">
          <option value="invited">–ü—Ä–∏–≥–ª–∞—à—ë–Ω</option>
          <option value="confirmed">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª</option>
          <option value="declined">–û—Ç–∫–∞–∑–∞–ª—Å—è</option>
        </select>
      </label>

      <label class="md:col-span-12">
        <span class="text-xs text-gray-500 block mb-1">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</span>
        <input name="notes" class="border p-2 rounded-xl w-full" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
      </label>

      <div class="md:col-span-12">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-xl shadow">
          –î–æ–±–∞–≤–∏—Ç—å
        </button>
      </div>
    </form>
  </div>

  <!-- —Ç–∞–±–ª–∏—Ü–∞ -->
  <div class="bg-white rounded-2xl border p-4 shadow">
    <div class="overflow-x-auto rounded-xl border">
      <table class="min-w-full rounded-lg overflow-hidden text-sm">
        <thead>
          <tr class="bg-pink-50">
            <th class="p-2 font-bold">–ò–º—è</th>
            <th class="p-2 font-bold">–°–µ–º—å—è</th>
            <th class="p-2 font-bold text-right">–ü–µ—Ä—Å–æ–Ω</th>
            <th class="p-2 font-bold">–°—Ç–æ—Ä–æ–Ω–∞</th>
            <th class="p-2 font-bold">–¢–µ–≥–∏</th>
            <th class="p-2 font-bold">–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th class="p-2 font-bold">–°—Ç–∞—Ç—É—Å</th>
            <th class="p-2 font-bold text-center">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</th>
            <th class="p-2 font-bold text-center">–°—Ç–æ–ª ‚Ññ</th>
            <th class="p-2 font-bold text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% for g in wedding.guests %}
          {% set persons = g.family_count if g.family_count else 1 %}
          <tr class="bg-white hover:bg-pink-50/70 transition"
              x-show="rowVisible(
                '{{ (g.side or '')|e }}',
                {{ 1 if g.is_vip else 0 }},
                {{ 1 if g.is_child else 0 }},
                '{{ ((g.name or '') ~ ' ' ~ (g.family_name or '') ~ ' ' ~ (g.phone or ''))|trim|e }}',
                {{ g.table_no or 0 }}
              )">
            <td class="p-2">{{ g.name or '‚Äî' }}</td>
            <td class="p-2">
              {% if g.family_name %}
                <span class="inline-flex items-center gap-1 bg-indigo-50 text-indigo-700 px-2 py-0.5 rounded-lg border border-indigo-100">
                  üë®‚Äçüë©‚Äçüëß {{ g.family_name }}
                </span>
              {% else %} ‚Äî {% endif %}
            </td>
            <td class="p-2 text-right">{{ persons }}</td>
            <td class="p-2">
              {% if g.side == 'groom' %}<span class="px-2 py-0.5 rounded-xl bg-blue-50 text-blue-700 text-xs">–ñ–µ–Ω–∏—Ö</span>{% endif %}
              {% if g.side == 'bride' %}<span class="px-2 py-0.5 rounded-xl bg-pink-50 text-pink-700 text-xs">–ù–µ–≤–µ—Å—Ç–∞</span>{% endif %}
              {% if g.side == 'other' %}<span class="px-2 py-0.5 rounded-xl bg-gray-100 text-gray-700 text-xs">–î—Ä—É–≥–∞—è</span>{% endif %}
              {% if not g.side %}‚Äî{% endif %}
            </td>
            <td class="p-2">
              <div class="flex flex-wrap gap-1">
                {% if g.is_vip %}<span class="px-2 py-0.5 rounded-xl bg-amber-100 text-amber-800 text-xs">VIP</span>{% endif %}
                {% if g.is_child %}<span class="px-2 py-0.5 rounded-xl bg-emerald-100 text-emerald-800 text-xs">–î–µ—Ç–∏</span>{% endif %}
                {% if not g.is_vip and not g.is_child %}‚Äî{% endif %}
              </div>
            </td>
            <td class="p-2">{{ g.phone or '‚Äî' }}</td>
            <td class="p-2">
              {% if g.status == 'confirmed' %}
                <span class="inline-flex items-center gap-1 bg-green-200 text-green-800 px-2 py-0.5 rounded-xl font-semibold">‚úì –ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª</span>
              {% elif g.status == 'declined' %}
                <span class="inline-flex items-center gap-1 bg-red-200 text-red-800 px-2 py-0.5 rounded-xl font-semibold">‚úï –û—Ç–∫–∞–∑–∞–ª—Å—è</span>
              {% else %}
                <span class="inline-flex items-center gap-1 bg-gray-200 text-gray-700 px-2 py-0.5 rounded-xl font-semibold">‚óè –ü—Ä–∏–≥–ª–∞—à—ë–Ω</span>
              {% endif %}
            </td>
            <td class="p-2 text-center">
              <a href="{{ url_for('invitations_bp.invitation_pdf', wedding_id=wedding.id, guest_id=g.id) }}"
                 class="inline-block bg-pink-100 hover:bg-pink-200 px-3 py-1 rounded-lg text-pink-700 text-sm shadow"
                 target="_blank">üéüÔ∏è PDF</a>
            </td>
            <td class="p-2">
              <form method="POST" action="{{ url_for('wedding_pages.set_table', guest_id=g.id) }}" class="flex items-center justify-center gap-1">
                <input type="number" min="1" name="table_no" value="{{ g.table_no or '' }}"
                       class="w-16 border rounded-xl px-2 py-1 text-right">
                <button class="text-blue-600 hover:text-blue-800" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">üíæ</button>
              </form>
            </td>
            <td class="p-2">
              <div class="flex gap-2 justify-center">
                <button
                  @click="openEdit({{ g.id }},
                                    '{{ g.name|default('', true)|escape }}',
                                    '{{ g.phone|default('', true)|escape }}',
                                    '{{ g.status }}',
                                    '{{ g.notes|default('', true)|escape }}',
                                    '{{ g.family_name|default('', true)|escape }}',
                                    '{{ g.family_count or 1 }}',
                                    '{{ g.side or '' }}',
                                    {{ 1 if g.is_vip else 0 }},
                                    {{ 1 if g.is_child else 0 }},
                                    {{ g.table_no or 0 }})"
                  class="px-2 py-1 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-100"
                  title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>

                <form method="POST" action="{{ url_for('wedding_pages.delete_guest', guest_id=g.id) }}"
                      onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?');" class="inline">
                  <button type="submit" class="px-2 py-1 rounded-lg bg-rose-50 hover:bg-rose-100 text-rose-700 border border-rose-100" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- –∏—Ç–æ–≥–∏ -->
    <div class="mt-3 flex flex-wrap gap-x-6 gap-y-2 text-sm text-gray-700">
      <div>–ó–∞–ø–∏—Å–µ–π: <span class="font-semibold">{{ wedding.guests|length }}</span></div>
      <div>–ü–µ—Ä—Å–æ–Ω: <span class="font-semibold">{{ total_persons }}</span></div>
      <div>–°—Ç–æ–ª–æ–≤ (–ø–æ {{ table_size }}): <span class="font-semibold">{{ tables_needed }}</span></div>
    </div>
  </div>

  <!-- –º–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div x-show="editOpen" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50" style="display:none;">
    <div class="bg-white rounded-2xl p-6 shadow-xl w-full max-w-2xl">
      <h3 class="text-lg font-bold mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Å—Ç—è / —Å–µ–º—å—é</h3>
      <form :action="editActionUrl" method="POST" class="grid md:grid-cols-12 gap-3">
        <label class="md:col-span-4">
          <span class="text-xs text-gray-500 block mb-1">–ò–º—è –≥–æ—Å—Ç—è (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)</span>
          <input type="text" name="name" x-model="editName" class="border p-2 rounded-xl w-full">
        </label>
        <label class="md:col-span-4">
          <span class="text-xs text-gray-500 block mb-1">–°–µ–º—å—è</span>
          <input type="text" name="family_name" x-model="editFamilyName" class="border p-2 rounded-xl w-full">
        </label>
        <label class="md:col-span-2">
          <span class="text-xs text-gray-500 block mb-1">–ü–µ—Ä—Å–æ–Ω</span>
          <input type="number" min="1" name="family_count" x-model="editFamilyCount" class="border p-2 rounded-xl w-full">
        </label>
        <label class="md:col-span-2">
          <span class="text-xs text-gray-500 block mb-1">–°—Ç–æ–ª ‚Ññ</span>
          <input type="number" min="1" name="table_no" x-model="editTableNo" class="border p-2 rounded-xl w-full">
        </label>

        <label class="md:col-span-4">
          <span class="text-xs text-gray-500 block mb-1">–°—Ç–æ—Ä–æ–Ω–∞</span>
          <select name="side" x-model="editSide" class="border p-2 rounded-xl w-full">
            <option value="">‚Äî</option>
            <option value="groom">–°–æ —Å—Ç–æ—Ä–æ–Ω—ã –∂–µ–Ω–∏—Ö–∞</option>
            <option value="bride">–°–æ —Å—Ç–æ—Ä–æ–Ω—ã –Ω–µ–≤–µ—Å—Ç—ã</option>
            <option value="other">–î—Ä—É–≥–∞—è</option>
          </select>
        </label>
        <label class="md:col-span-2 flex items-center gap-2">
          <input type="checkbox" name="is_vip" :checked="editVIP" @change="editVIP=$event.target.checked" class="rounded">
          <span class="text-sm">VIP</span>
        </label>
        <label class="md:col-span-2 flex items-center gap-2">
          <input type="checkbox" name="is_child" :checked="editChild" @change="editChild=$event.target.checked" class="rounded">
          <span class="text-sm">–†–µ–±—ë–Ω–æ–∫</span>
        </label>

        <label class="md:col-span-4">
          <span class="text-xs text-gray-500 block mb-1">–¢–µ–ª–µ—Ñ–æ–Ω</span>
          <input type="text" name="phone" x-model="editPhone" class="border p-2 rounded-xl w-full">
        </label>
        <label class="md:col-span-4">
          <span class="text-xs text-gray-500 block mb-1">–°—Ç–∞—Ç—É—Å</span>
          <select name="status" x-model="editStatus" class="border p-2 rounded-xl w-full">
            <option value="invited">–ü—Ä–∏–≥–ª–∞—à—ë–Ω</option>
            <option value="confirmed">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª</option>
            <option value="declined">–û—Ç–∫–∞–∑–∞–ª—Å—è</option>
          </select>
        </label>
        <label class="md:col-span-12">
          <span class="text-xs text-gray-500 block mb-1">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</span>
          <input type="text" name="notes" x-model="editNotes" class="border p-2 rounded-xl w-full">
        </label>

        <div class="md:col-span-12 flex justify-end gap-2">
          <button type="button" @click="editOpen=false" class="px-4 py-2 bg-gray-200 rounded-xl">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-xl">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Alpine -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script>
function guestPage(editUrlTemplate) {
  return {
    // —Ñ–∏–ª—å—Ç—Ä—ã
    q: '',
    filterSide: '',
    filterVIP: '',
    filterKids: '',
    filterTable: null,

    // —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    editOpen: false,
    editId: null,
    editName: '', editPhone: '', editStatus: 'invited', editNotes: '',
    editFamilyName: '', editFamilyCount: 1,
    editSide: '', editVIP: false, editChild: false, editTableNo: null,

    get editActionUrl() {
      if (this.editId === null) return editUrlTemplate;
      return editUrlTemplate.replace(/\/0(\/|$)/, `/${this.editId}$1`);
    },
    openEdit(id, name, phone, status, notes, familyName, familyCount, side, vip, child, tableNo) {
      this.editId = id;
      this.editName = name || '';
      this.editPhone = phone || '';
      this.editStatus = status || 'invited';
      this.editNotes = notes || '';
      this.editFamilyName = familyName || '';
      this.editFamilyCount = parseInt(familyCount || 1, 10);
      this.editSide = side || '';
      this.editVIP = !!vip;
      this.editChild = !!child;
      this.editTableNo = tableNo || null;
      this.editOpen = true;
    },

    rowVisible(side, vip, kid, text, tableNo) {
      if (this.filterSide && side !== this.filterSide) return false;
      if (this.filterVIP !== '') {
        if (this.filterVIP === '1' && !vip) return false;
        if (this.filterVIP === '0' && vip) return false;
      }
      if (this.filterKids !== '') {
        if (this.filterKids === '1' && !kid) return false;
        if (this.filterKids === '0' && kid) return false;
      }
      if (this.filterTable && parseInt(this.filterTable) !== (parseInt(tableNo) || 0)) return false;
      if (this.q && !String(text).toLowerCase().includes(this.q.toLowerCase())) return false;
      return true;
    }
  }
}
</script>
{% endblock %}
